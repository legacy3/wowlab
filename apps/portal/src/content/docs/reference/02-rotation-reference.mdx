---
title: Rotation Reference
description: Complete reference for rotation expressions and syntax
updatedAt: 2026-01-17
---

# Rotation Reference

Complete reference for all rotation expressions and syntax.

## AST structure

Rotations compile to an abstract syntax tree:

```rust
Rotation {
    name: String,
    variables: HashMap<String, Expr>,   // User-defined
    lists: HashMap<String, Vec<Action>>,  // Named action lists
    actions: Vec<Action>,                // Entry point
}

Action::Cast { spell, condition }
Action::Call { list, condition }        // Returns if no match
Action::Run { list, condition }         // Continues even if no match
Action::SetVar { name, value, condition }
Action::ModifyVar { name, op, value, condition }
Action::Wait { seconds, condition }
Action::WaitUntil { condition }
Action::Pool { extra, condition }
Action::UseTrinket { slot, condition }
Action::UseItem { name, condition }
```

## Expression types

<Mermaid
  chart={`
mindmap
  root((Expr))
    Literals
      Bool
      Int
      Float
    Resources
      Current
      Max
      Deficit
      Percent
      Regen
      TimeToMax
    Cooldowns
      Ready
      Remaining
      Charges
      ChargesFractional
    Auras
      Active
      Stacks
      Remaining
      Refreshable
    Combat
      Time
      Remaining
    Target
      Health
      HealthPercent
      TimeToDie
      Distance
    Player
      Haste
      Crit
      Moving
    Logical
      And
      Or
      Not
    Comparison
      Gt, Gte, Lt, Lte
      Eq, Ne
    Arithmetic
      Add, Sub, Mul, Div
`}
/>

## Resource expressions

Query resource pools (focus, energy, mana, etc.):

| Expression          | Type | Description                    |
| ------------------- | ---- | ------------------------------ |
| `focus.current`     | f64  | Current amount                 |
| `focus.max`         | f64  | Maximum capacity               |
| `focus.deficit`     | f64  | Amount missing (max - current) |
| `focus.percent`     | f64  | Percentage (0 - 100)           |
| `focus.regen`       | f64  | Regeneration per second        |
| `focus.time_to_max` | f64  | Seconds until capped           |

Works with any resource: `energy`, `mana`, `rage`, `runic_power`, etc.

## Cooldown expressions

Query spell cooldowns:

| Expression                          | Type | Description                   |
| ----------------------------------- | ---- | ----------------------------- |
| `cooldown.spell.ready`              | bool | Off cooldown and castable     |
| `cooldown.spell.remains`            | f64  | Seconds until ready           |
| `cooldown.spell.charges`            | i32  | Current charges (charged CDs) |
| `cooldown.spell.charges_fractional` | f64  | Including partial recharge    |

## Aura expressions

Query buffs and debuffs:

| Expression                | Type | Description                        |
| ------------------------- | ---- | ---------------------------------- |
| `buff.name.active`        | bool | Aura is currently applied          |
| `buff.name.stacks`        | i32  | Current stack count                |
| `buff.name.remains`       | f64  | Seconds until expires              |
| `buff.name.refreshable`   | bool | In pandemic window (30% remaining) |
| `debuff.name.active`      | bool | Debuff on target                   |
| `debuff.name.stacks`      | i32  | Debuff stack count                 |
| `debuff.name.remains`     | f64  | Debuff time remaining              |
| `debuff.name.refreshable` | bool | Debuff in pandemic window          |

## Combat expressions

Query fight state:

| Expression       | Type | Description              |
| ---------------- | ---- | ------------------------ |
| `combat.time`    | f64  | Seconds since pull       |
| `combat.remains` | f64  | Seconds until fight ends |

## Target expressions

Query enemy state:

| Expression              | Type | Description                   |
| ----------------------- | ---- | ----------------------------- |
| `target.health`         | f64  | Current health                |
| `target.health_percent` | f64  | Health percentage (0 - 100)   |
| `target.time_to_die`    | f64  | Estimated seconds until death |
| `target.distance`       | f64  | Distance in yards             |

## Player expressions

Query player state:

| Expression      | Type | Description                |
| --------------- | ---- | -------------------------- |
| `player.haste`  | f64  | Haste percentage (0 - 100) |
| `player.crit`   | f64  | Crit percentage (0 - 100)  |
| `player.moving` | bool | Currently moving           |

## Variable expressions

Reference user-defined variables:

```json
{
  "variables": {
    "use_cds": "combat.time > 5 & buff.bloodlust.active"
  },
  "actions": [{ "cast": "bestial_wrath", "if": "variable.use_cds" }]
}
```

Access with `variable.name`.

## Logical operators

Combine conditions:

| Operator | Syntax | Example                            |
| -------- | ------ | ---------------------------------- |
| And      | `&`    | `buff.x.active & cooldown.y.ready` |
| Or       | `\|`   | `buff.x.active \| buff.y.active`   |
| Not      | `!`    | `!buff.x.active`                   |

## Comparison operators

Compare values:

| Operator         | Syntax | Example                      |
| ---------------- | ------ | ---------------------------- |
| Greater than     | `>`    | `focus.current > 50`         |
| Greater or equal | `>=`   | `buff.x.stacks >= 3`         |
| Less than        | `<`    | `target.health_percent < 20` |
| Less or equal    | `<=`   | `cooldown.x.remains <= 2`    |
| Equal            | `=`    | `buff.x.stacks = 5`          |
| Not equal        | `!=`   | `target.count != 1`          |

## Arithmetic operators

Perform calculations:

| Operator | Syntax | Example                     |
| -------- | ------ | --------------------------- |
| Add      | `+`    | `focus.current + 30`        |
| Subtract | `-`    | `focus.max - focus.current` |
| Multiply | `*`    | `player.haste * 1.1`        |
| Divide   | `/`    | `buff.x.remains / 3`        |

## Evaluation result

The JIT function returns a packed result:

```rust
EvalResult {
    kind: u8,       // 0=none, 1=cast, 2=wait, 3=pool
    spell_id: u32,  // Spell index (24 bits)
    wait_time: f32, // Seconds to wait (or pool target)
}

// Packed as u64: bits 0-31=wait_time, 32-55=spell_id, 56-63=kind
```

## Next steps

- [Writing Rotations](/dev/docs/guides/00-writing-rotations) - Practical guide
- [JIT Compiler](/dev/docs/engine/02-jit-compiler) - How rotations compile to native code
